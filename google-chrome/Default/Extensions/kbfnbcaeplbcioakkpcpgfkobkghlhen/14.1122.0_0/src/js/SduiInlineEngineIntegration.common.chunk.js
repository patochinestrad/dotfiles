(self.webpackChunk=self.webpackChunk||[]).push([[5275],{99040:(e,t,s)=>{s.d(t,{f:()=>a});const i="MockCAPIPlagiarismClient. Not implemented yet. That implementation is a placeholder for the actual implementation, of the plagiarism feature. Proper implementation will be done later by the responsible team. That placeholder is required to be able to update SDUI version in extension. Client won't get those actions (enablePlagiarismSearch, disablePlagiarismSearch) as they are disabled in 'src/js/universal/bg/sdui/config.ts'.",a={enablePlagiarismSearch:()=>{throw new Error(i)},disablePlagiarismSearch:()=>{throw new Error(i)}}},27616:(e,t,s)=>{s.r(t),s.d(t,{createSduiInlineEngine:()=>Z,default:()=>q});var i=s(5114),a=s(21038),n=s(24055),r=s(12054),o=s(78929),d=s(28542),c=s(31903),l=s(9922),p=s(85985),h=s(77176),u=s(80358),g=s(57050),m=s(33194),A=s(38983),v=s(72812),w=s(14454),b=s(31668),_=s(22232),C=s(71249),S=s(73975),f=s(26886),k=s(40151),P=s(95195),y=s(8125);class H{constructor(){this.feed=k.E,this.currentFeed=i.none,this.onFeedRemove=k.E,this.onFeedEmpty=k.E,this.header=k.E,this.footer=k.E,this.pushFeed=()=>P.right(null),this.popFeed=y.Q1,this.focusCard=()=>P.right(null),this.notifyCardFocused=y.Q1,this.dispose=y.Q1}}var I,x=s(39040),E=s(55818),G=s(8901),L=s(32952),F=s(19751),T=s(23063),U=s(69627),M=s(11610),R=s(31528),N=s(26328),Q=s(15646),V=s(99040);class O{constructor(e,t,s,a){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=s,this.integrationModel=a,this._focusedItem=A.h.create(i.none),this._sduiInlineCardActions=new L.xQ,this._subs=new l.w.Keeper,this.focusCard=e=>{this._focusedItem.set(i.some(e))},this.handleSduiCardAction=(e,t,s)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:s})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,g.zG)(O.getSduiFeedActions(e.actions),i.map((t=>this.integrationModel.openAssistant({type:R.WT.sdui,action:{...e,actions:t,type:Q.lY.Type.sduiCardAction}}))))},this._handleSduiCardAction=({cardAction:e,match:t,cardModel:s})=>{this._sduiViewModel.sduiActionEvents.next(e),this._nativeHandling(e,t,s)},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new v.x(t,e,new H,V.f,this._focusedItem.view(i.map((e=>e.id)))),this._subs.push(this._sduiInlineCardActions.pipe(F.skipBy(I.eq)).subscribe(this._handleSduiCardAction),this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:s,scope:a},n,r){(0,g.zG)(O.getSduiFeedActions(e),i.map((e=>{r.onOpenExpandedViewBySduiAction(m.Oe.create(e,t,s,a))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"closePopover":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"openLink":return void this.environment.actions.openPopup(new b.Z(e.url));case"copyToClipboard":return void(0,g.zG)((0,f.v)(e.text),T.q(1)).subscribe();case"stopApplyingAlerts":case"upgradeToPremium":return r.openPlanComparisonPage({forceUtmCampaign:G.L.Place.assistantCardList}),void n.hide();case"applyAlerts":if(null==n.alert)return;return(0,g.zG)((0,x.UQ)(n.alert,n.plainText),(e=>new E.U_(e,(e=>n.replace(null!=e?e:"",!1)))),(t=>(0,g.zG)(i.fromNullable(t.replacements[e.alternativeIndex]),i.map((e=>t.getOnReplace(e)()))))),void n.hide();case"closeCard":case"removeRoot":return void n.hide();case"removeAlerts":return n.ignore(),void n.hide();case"openGrammarlyGo":if(n.alert&&(0,U.t)(n.alert.patternName)){const e=(0,x.UQ)(n.alert,n.plainText);if(e.length>0&&e[0].newText){const t=e[0].newText;r.onOpenGrammarlyGo({mode:M.w.pushRewrite,writingExpertContext:{alertId:n.alert.id,alertPname:n.alert.patternName,originalText:n.alert.text,replacementText:t},transformRange:n.alert.transformRange})}else r.onOpenGrammarlyGo({mode:M.w.ideation})}else r.onOpenGrammarlyGo({mode:M.w.ideation});return;default:(0,_.L0)(e)}}))}}O.getSduiFeedActions=(0,g.ls)(C.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),N.nI),function(e){e.eq=S.MW({cardAction:w.t.eq})}(I||(I={}));var B=s(624);class D extends B.J{constructor(){super(),this._popoverActionsHandler=A.h.create(i.none)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(i.some(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}}class W{constructor(){this.activePopoverStack=A.h.create(i.none),this.activePopoverView=A.h.create(i.none),this._popoverActionsHandler=A.h.create(i.none)}addPopover(e,t){}getInteractionActions(e,t,s){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}}const Z=(e,t,s,A,v,w,b=!1)=>{const _=new l.w.Keeper,C=(0,g.ls)((e=>e.toString()),s,i.fromNullable,i.map((e=>a.j.AlertId.from(e.id)))),S=e.capiEvents.pipe(p.h(u.h.is("sdui_add","sdui_remove","sdui_update")),p.h((e=>"sdui_remove"===e.kind||m.D1.InlineCard.isInlineCard(e.sdui)||m.D1.StrongAlertRef.isStrongAlertRefUpgradeHookContent(e.sdui)||m.D1.GButton.isGButtonContent(e.sdui)||m.D1.PopoverStack.isPopoverStack(e.sdui))),p.h(n.e.isSduiEvent),h.U(r.al.fromSource(r.i5.CAPI))),f=b?new D:new W,k=new o.G(S,C,f),P=new d.D(k.state),y=new c.Q({sendUserAction:A}),H=new O(k,y,v,w);return f.setPopoverActionsHandler(H),_.push(t.subscribe((e=>k.notifyAlertsChanged())),e.capiEvents.pipe(p.h(u.h.is("session_started")),p.h((e=>e.isNewSession))).subscribe((e=>k.onSessionStarted())),e.capiEvents.pipe(p.h(u.h.is("finish")),p.h((e=>0===e.revision))).subscribe((e=>k.onFirstCheckingFinished())),k,P,H),{sduiBufferService:e,sduiManager:k,sduiInlineManager:P,sduiFeedbackService:y,inlineCardViewModel:H,dispose:()=>{_.dispose()}}},q={createSduiInlineEngine:Z}},8901:(e,t,s)=>{s.d(t,{L:()=>i,x:()=>f});var i,a=s(40327),n=s(75099),r=s(47612),o=s(75982),d=s(66896),c=s(74660),l=s(6782),p=s(4390),h=s(2844),u=s(77176),g=s(98403),m=s(5114),A=s(8125),v=s(95574),w=s(95195),b=s(38983),_=s(81531),C=s(20641),S=s(44358);!function(e){let t;!function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant",e.toneSuggestion="toneSuggestion"}(t=e.Place||(e.Place={}))}(i||(i={}));class f{constructor(e,t,s,i){this._alertsList=e,this._lensState=t,this._maxAlertCategories=s,this.gnar=i,this._log=_.C8.Logging.getLogger("UpgradeViewModel"),this._advancedAlerts=b.h.create([]),this.advancedAlerts=this._advancedAlerts.view((e=>e.length>0?m.some({count:e.length,alerts:()=>this._formatLiteAlerts(f._getGroupedLiteAlerts(e))}):m.none)),this._formatLiteAlerts=e=>{const t=e.slice(0,this._maxAlertCategories),s=e.slice(this._maxAlertCategories).map((e=>e.count)).reduce(A.Sm,0);return s>0?[...t,{group:"",category:"",categoryHuman:"more...",count:s,lensName:"",bundleInfo:m.none}]:t},this._connectionId=o._.createWithRandomId("sidebar"),h.aj([this._lensState.view("currentLens").view("id").view(d.R.isPriority).view((e=>e?e=>c.bZ.isRegistered(e)&&c.bZ.isPremium(e)&&c.bZ.isPriority(e):e=>c.bZ.isRegistered(e)&&c.bZ.isPremium(e))),this._alertsList.state]).pipe(u.U((([e,t])=>p.p.reduce([],((t,{alert:s})=>(e(s)&&t.push(s),t)))(t)))).subscribe(g.wW(this._advancedAlerts))}trackUpgradeButtonShow(e){const t=this._advancedAlerts.get();(0,S.n)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),this.gnar.assistantExpandedUpgradeHookShow(t.length,100),(0,C.Tb)().upgradeHooks.showUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}trackUpgradeButtonClick(e){const t=this._advancedAlerts.get();(0,S.Q)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),(0,C.Tb)().upgradeHooks.clickUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}openUpgradeUrl(e){(0,a.pipe)(v.tryCatchError((()=>{(0,r.P4)().openSubscriptionDialog({currentAlerts:this._getCapiAlerts(),isAnonymousUser:!1,isFromEmail:!1,forceUtmCampaign:e})})),w.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}_getCapiAlerts(){return this._advancedAlerts.get().map((e=>(0,n.IM)(f._toRawAlertWithPossibleWrongId(e),o.Q.create(this._connectionId,0))))}static _getGroupedLiteAlerts(e){return l.Q.group(e.map((e=>e.toLiteAlert())))}static _toRawAlertWithPossibleWrongId(e){return{...e.toRawAlert(),id:(0,a.pipe)(e.rawId,m.getOrElse((()=>e.id)))}}}}}]);