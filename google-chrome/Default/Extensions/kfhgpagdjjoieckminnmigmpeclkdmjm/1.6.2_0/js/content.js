(function(){"use strict";if(window.onerror=function(e,t,n,i,s){return console.group(`%c ATBE ERROR (${new Date().toLocaleTimeString()}) \u26A0 `,"color: yellow; background: red;"),console.error(s),console.groupEnd(),!0},!ExtAutoInject.pageMathes)return;const De=document.documentElement,a=new ExtStorageManager(null,ut);new ExtAutoInject().then(me);const Ie={playbackFailedTimes:0,fetchFailedTimes:0,beforeCheckTime:1/0},qe={videoElement:null,playerActive:!1,playerFit:!1,pageUrl:location.href,prevUrl:null,integrityFailed:0},W=[],se=[],Ce=ee(10),lt=E();let ae=null,oe=null,V=null,Ne=null,dt=null,re=null,ce=null,le=null,de=null,x=null,ue=null,D=!1,O=null,F=null,U=null,R=null,Re=0,T=J(Ie),d=J(qe);ze(()=>{try{let e=!1;const t=arguments[0],n=s=>{let o=100;const r=s.data.autoTwitchBrowserExtensionIntegrity,c=s.data.autoTwitchBrowserExtensionShutdown,l=()=>{if(o--){if("KPSDK"in window&&!KPSDK.isReady()){setTimeout(l,100);return}fetch("https://gql.twitch.tv/integrity",{method:"post",headers:r})}};s.source===window&&(r?l():c===t&&(window.removeEventListener("message",n),e=!0))};window.addEventListener("message",n),window._originalFetch=window._originalFetch||fetch,window.fetch=new Proxy(fetch,{apply:(s,o,r)=>{if(!e&&r&&typeof r[0]=="string"&&r[0].match(/^https:\/\/gql\.twitch\.tv\/gql/)){const l=r[1]&&r[1].body&&JSON.parse(r[1].body)||null;l&&l.operationName==="PlaybackAccessToken"&&["embed","popout"].includes(l.variables.playerType)&&(l.variables.playerType="site",r[1].body=JSON.stringify(l))}const c=s.apply(o,r);return c.then(l=>{e||(l.url==="https://gql.twitch.tv/gql"&&l.clone().json().then(m=>{try{m.some(u=>{if(u.extensions.operationName==="ChannelPointsContext"){const w=u.data.community.channel.self.communityPoints.availableClaim;return w&&window.postMessage({autoTwitchBrowserExtension:{claimID:w.id,channelID:u.data.community.channel.id}},"*"),!0}if(u.extensions.operationName==="DropCurrentSessionContext")return u.data.currentUser.dropCurrentSession.currentMinutesWatched===u.data.currentUser.dropCurrentSession.requiredMinutesWatched&&window.postMessage({autoTwitchBrowserExtension:{drop:!0}},"*"),!0})}catch{}}),l.url==="https://gql.twitch.tv/integrity"&&l.clone().json().then(m=>{try{m&&m.token&&window.postMessage({autoTwitchBrowserExtension:{integrity:m}},"*")}catch{}}))}).catch(l=>{throw(l.message=/hls\.ttvnw\.net|gql\.twitch\.tv/.test(r[0]))&&window.postMessage({autoTwitchBrowserExtension:{fetchFailed:!0}},"*"),l}),c}}),window._originalWebSocket=window._originalWebSocket||WebSocket,window.WebSocket=new Proxy(_originalWebSocket,{construct:(s,o)=>{const r=new s(...o);if(r.addEventListener("message",c=>{try{if(c.target.url!=="wss://pubsub-edge.twitch.tv/v1")return;const l=JSON.parse(c.data);if(l.type!=="MESSAGE")return;if(l.data.topic.match(/^community-points-user-v1/)){const m=JSON.parse(l.data.message);if(m.type!=="claim-available")return;const u=m.data.claim;u&&window.postMessage({autoTwitchBrowserExtension:{claimID:u.id,channelID:u.channel_id}},"*");return}if(l.data.topic.match(/^user-drop-events/)){const m=JSON.parse(l.data.message);if(m.type!=="drop-claim")return;!!m.data.drop_instance_id&&window.postMessage({autoTwitchBrowserExtension:{drop:!0}},"*");return}if(l.data.topic.match(/^community-moments-channel/)){const m=JSON.parse(l.data.message);if(m.type!=="active")return;const u=m.data;window.postMessage({autoTwitchBrowserExtension:{momentID:u.moment_id,channelID:u.channel_id,clipSlug:u.clip_slug}},"*")}if(l.data.topic.match(/^predictions-channel-v1/)){const m=JSON.parse(l.data.message);if(!["event-created","event-updated"].includes(m.type))return;const u=m.data.event;u&&u.status==="ACTIVE"&&window.postMessage({autoTwitchBrowserExtension:{predictionActive:u}},"*")}if(l.data.topic.match(/^predictions-user-v1/)){const m=JSON.parse(l.data.message);if(m.type!=="prediction-result")return;const u=m.data.prediction;u&&window.postMessage({autoTwitchBrowserExtension:{predictionResult:u}},"*")}}catch{}}),location.hostname==="player.twitch.tv")try{let c=document.cookie.match(/(?:^|; )twilight-user=([^;]*)/);c=c&&JSON.parse(decodeURIComponent(c[1])),c&&r.addEventListener("open",()=>{const l=()=>Math.random().toString(36).substr(2,10).repeat(3),m=new URL(location.href).searchParams.get("channel");fetch("https://gql.twitch.tv/gql",{method:"post",headers:{Authorization:`OAuth ${c.authToken}`},body:JSON.stringify([{operationName:"FollowButton_User",extensions:{persistedQuery:{sha256Hash:"870906a2de25d7488239dbeb947dafe3e5697f1fef2e8bce6601555a17e4d86d",version:1}},variables:{login:m}}])}).then(u=>u.json()).then(u=>{try{if(u&&u[0]&&u[0].errors&&u[0].errors[0])throw new Error(`ERROR: ${u[0].errors[0].message}`);const w=u[0].data.user.id;r.send(`{"type":"LISTEN","nonce":"${l()}","data":{"topics":["community-points-user-v1.${c.id}"],"auth_token":"${c.authToken}"}}`),r.send(`{"type":"LISTEN","nonce":"${l()}","data":{"topics":["user-drop-events.${c.id}"],"auth_token":"${c.authToken}"}}`),r.send(`{"type":"LISTEN","nonce":"${l()}","data":{"topics":["community-moments-channel-v1.${w}"],"auth_token":"${c.authToken}"}}`),r.send(`{"type":"LISTEN","nonce":"${l()}","data":{"topics":["predictions-channel-v1.${w}"],"auth_token":"${c.authToken}"}}`),r.send(`{"type":"LISTEN","nonce":"${l()}","data":{"topics":["predictions-user-v1.${c.id}"],"auth_token":"${c.authToken}"}}`)}catch{}}).catch(u=>{throw u})})}catch{}return r}});const i={apply:(s,o,r)=>{const c=s.apply(o,r);return window.postMessage({autoTwitchBrowserExtension:{historyUpdated:!0}},"*"),c}};window._originalHistory=window._originalHistory||history,window.history.pushState=new Proxy(_originalHistory.pushState,i),window.history.replaceState=new Proxy(_originalHistory.replaceState,i),document.documentElement.classList.add("_ATBE_INTER_")}catch(e){console.group("%c ATBE ERROR \u26A0 ","color: yellow; background: red;"),console.error(e),console.groupEnd()}}),Dt();function ut(e){a.onUpdate("settings.enabled",t=>{t?Me():xe()}).onUpdate("settings.changeIcon",t=>{t&&a.get("settings.enabled")?K(d.playerActive&&!ve()):K()}).onUpdate("settings.hideExtensions",X).onUpdate("settings.showPreviews",Te).onUpdate("settings.clickPause",Z).onUpdate("settings.claimPoints",t=>{t&&pe()}).onUpdate("settings.claimDrops",t=>{t&&Q()}).onUpdate("processExtensionReload",t=>{t&&me()}),e.settings.enabled&&Me(),chrome.runtime.sendMessage("registerTab"),window.addEventListener("beforeunload",()=>{!D&&chrome.runtime.sendMessage("unregisterTab")}),chrome.runtime.onMessage.addListener(Fe),Xe()}function Me(){if(window.addEventListener("message",Oe),window.addEventListener("popstate",be),Ke(),vt(),Ye(),X(),Te(),Z(),document.readyState!=="complete"){He(!0),Je(!0);return}De.classList.contains("_ATBE_INTER_")?(pe(),Q()):Y()}function xe(){window.removeEventListener("message",Oe),window.removeEventListener("popstate",be),clearTimeout(ae),clearTimeout(oe),clearTimeout(V),clearTimeout(ce),clearTimeout(le),clearTimeout(de),clearTimeout(dt),clearTimeout(re),X(),Te(),Z(),N(),he(),fe(),T=J(Ie),d=J(qe),Pt(),K()}function me(){window.postMessage({autoTwitchBrowserExtensionShutdown:Ce},"*"),D=!0,clearTimeout(Ne),xe(),chrome.runtime.onMessage.removeListener(Fe),a.offUpdate()}function Oe(e){const t=e.data.autoTwitchBrowserExtension;e.source!==window||!t||setTimeout(()=>{if(t.claimID)return Ue(t);if(t.drop)return Q();if(t.momentID)return gt(t);if(t.fetchFailed)return Qe();if(t.historyUpdated)return be();if(t.predictionActive)return St(t.predictionActive);if(t.predictionResult)return Bt(t.predictionResult);if(t.integrity){R=t.integrity;return}},document.readyState==="complete"?1e3:3e3)}function Fe(e){e.visualAlert?ft(e.visualAlert):e.visualAlertClose?ht(e.visualAlertClose):e.delayedReload&&Ge(e.delayedReload)}function pe(){!a.get("settings.enabled")||!a.get("settings.claimPoints")||(_e()&&k().then(e=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:e,body:JSON.stringify([{operationName:"ChannelPointsContext",extensions:{persistedQuery:{sha256Hash:"1530a003a7d374b0380b79db0be0534f30ff46e61cffa2bc0e2468a909fbc024",version:1}},variables:{channelLogin:we()}}])}).then(t=>t.json()).then(t=>{try{if($(t,"checkPoints")||!t[0]||!t[0].data||!t[0].data.community)return;const n=t[0].data.community.channel.self.communityPoints.availableClaim;n&&Ue({claimID:n.id,channelID:t[0].data.community.channel.id})}catch(n){f(n,"checkPoints")}}).catch(t=>{throw t})}).catch(e=>{f(e,"checkPoints")}),He())}function Q(){!a.get("settings.enabled")||!a.get("settings.claimDrops")||(k().then(e=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:e,body:JSON.stringify([{operationName:"Inventory",extensions:{persistedQuery:{sha256Hash:"37fea486d6179047c41d0f549088a4c3a7dd60c05c70956a1490262f532dccd9",version:1}},variables:{}}])}).then(t=>t.json()).then(t=>{try{if($(t,"checkDrops"))return;const n=[];t[0]&&t[0].data&&t[0].data.currentUser.inventory&&t[0].data.currentUser.inventory.dropCampaignsInProgress&&t[0].data.currentUser.inventory.dropCampaignsInProgress.forEach(i=>{i.timeBasedDrops.forEach(s=>{if(s.self.dropInstanceID&&!s.self.isClaimed&&s.benefitEdges.length){const o=JSON.parse(JSON.stringify(s.benefitEdges)),r=JSON.parse(JSON.stringify(s));r.type="drops",r.dropInstanceID=s.self.dropInstanceID,r.game=JSON.parse(JSON.stringify(i.game)),delete r.benefitEdges,delete r.self,delete r.__typename,delete r.campaign.self,delete r.campaign.__typename,delete r.game.__typename,o.forEach(c=>{const l=JSON.parse(JSON.stringify(r));l.benefit=JSON.parse(JSON.stringify(c)),l.benefit.imageAssetURL=c.benefit.imageAssetURL,l.benefit.name=c.benefit.name,delete l.benefit.benefit,delete l.benefit.__typename,n.push(l)}),mt(s.self.dropInstanceID,n)}})})}catch(n){f(n,"checkDrops")}}).catch(t=>{throw t})}).catch(e=>{f(e,"checkDrops")}),Je())}function Ue(e){a.get("settings.claimPoints")&&k().then(t=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:t,body:JSON.stringify([{operationName:"ClaimCommunityPoints",extensions:{persistedQuery:{sha256Hash:"46aaeebe02c99afdf4fc97c7c0cba964124bf6b0af229395f1f6d1feed05b3d0",version:1}},variables:{input:e}}])}).then(n=>n.json()).then(n=>{try{if($(n,"claimPoints")||!n[0].data.claimCommunityPoints.claim)return;const i=n[0].data.claimCommunityPoints.claim.pointsEarnedTotal;if(!i)return;pt(e.channelID,s=>{const o=a.get("statistics.totalPoints"),r=a.get("lastPoints");r.unshift(Object.assign(s,{type:"points",claimedAt:E(),channelID:e.channelID,claimID:e.claimID,points:i})),I("lastPoints",r),a.set("statistics.totalPoints",(o||0)+i),chrome.runtime.sendMessage({analytics:{name:"claim",params:{kind:"points",value:i}}})})}catch(i){f(i,"claimPoints")}}).catch(n=>{throw n})}).catch(t=>{f(t,"claimPoints")})}function mt(e,t){a.get("settings.claimDrops")&&k().then(n=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:n,body:JSON.stringify([{operationName:"DropsPage_ClaimDropRewards",extensions:{persistedQuery:{sha256Hash:"a455deea71bdc9015b78eb49f4acfbce8baa7ccbedd28e549bb025bd0f751930",version:1}},variables:{input:{dropInstanceID:e}}}])}).then(i=>i.json()).then(i=>{try{if($(i,"claimDrops")||!i[0].data.claimDropRewards)return;const s=a.get("lastDrops");if(s.some(l=>{if(l.dropInstanceID===e)return!0}))return;const r=a.get("statistics.totalDrops"),c=E();t.forEach(l=>{l.claimedAt=c,s.unshift(l)}),I("lastDrops",s),a.set("statistics.totalDrops",(r||0)+t.length),chrome.runtime.sendMessage({analytics:{name:"claim",params:{kind:"drops",value:t.length}}})}catch(s){f(s,"claimDrops")}}).catch(i=>{throw i})}).catch(n=>{f(n,"claimDrops")})}function pt(e,t){const n={image:null,pointsName:null,displayName:null},i=(s,o)=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:o,body:JSON.stringify([{operationName:"ChannelPointsContext",extensions:{persistedQuery:{sha256Hash:"1530a003a7d374b0380b79db0be0534f30ff46e61cffa2bc0e2468a909fbc024",version:1}},variables:{channelLogin:s}}])}).then(r=>r.json()).then(r=>{if($(r,"getPointsSettings")){t(n);return}const c=r[0].data.community.channel.communityPointsSettings,l=r[0].data.community.displayName;if(!c||!l){t(n);return}t({image:c.image&&c.image.url4x||null,pointsName:c.name,login:s,displayName:l})}).catch(()=>{t(n)})};k().then(s=>{Ee(e).then(o=>{i(o,s)}).catch(()=>{t(n)})}).catch(s=>{t(n),f(s,"getPointsSettings")})}function gt(e){if(!a.get("settings.claimMoments"))return;const t=n=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:n,body:JSON.stringify([{operationName:"WatchLivePrompt",extensions:{persistedQuery:{sha256Hash:"dcf741d88e5066ac8c140f1247309c36ce459b9c15a1ef726634081733d7147d",version:1}},variables:{slug:e.clipSlug}},{operationName:"ClipsTitle",extensions:{persistedQuery:{sha256Hash:"f6cca7f2fdfbfc2cecea0c88452500dae569191e58a265f97711f8f2a838f5b4",version:1}},variables:{slug:e.clipSlug}}])}).then(i=>i.json()).then(i=>{try{if($(i,"claimMoment"))return;const s=a.get("statistics.totalMoments"),o=a.get("lastMoments"),r=i[0].data.clip;delete r.__typename,delete r.broadcaster.__typename,delete r.broadcaster.stream.__typename,delete r.broadcaster.stream.game.__typename,o.unshift(Object.assign(r,{type:"moments",claimedAt:E(),momentID:e.momentID,slug:e.clipSlug,title:i[1].data&&i[1].data.clip&&i[1].data.clip.title||null})),I("lastMoments",o),a.set("statistics.totalMoments",(s||0)+1),chrome.runtime.sendMessage({analytics:{name:"claim",params:{kind:"moments",value:1}}})}catch(s){f(s,"claimMoment")}}).catch(i=>{throw i})};k().then(n=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:n,body:JSON.stringify([{operationName:"CommunityMomentCallout_Claim",extensions:{persistedQuery:{sha256Hash:"e2d67415aead910f7f9ceb45a77b750a1e1d9622c936d832328a0689e054db62",version:1}},variables:{input:{momentID:e.momentID}}}])}).then(i=>i.json()).then(i=>{try{if($(i,"claimMoment")||!i[0].data.claimCommunityMoment.moment)return;t(n)}catch(s){f(s,"claimMoment")}}).catch(i=>{throw i})}).catch(n=>{f(n,"claimMoment")})}function He(e){clearTimeout(ae),a.get("settings.claimPoints")&&(ae=setTimeout(pe,a.get(`config.${e?"reloadDelay":"checkPointsDelay"}`)))}function Je(e){clearTimeout(oe),a.get("settings.claimDrops")&&(oe=setTimeout(Q,a.get(`config.${e?"reloadDelay":"checkDropsDelay"}`)))}function ft(e){const t=We();if(!t)return;let n="",i=document.createElement("div");const s=e.item,o=s.type,r=`${o}:${s.claimID||s.dropInstanceID||s.momentID||s.id||0}`,c=e.duration||5,l=["raids","predictions","reloads"].includes(o),m=["points","moments","raids","predictions"].includes(o),u=["reloads"].includes(o),w=b("/icon/appicon_16.png"),y=b("/img/close-icon.svg"),_=b("/img/cancel-icon.svg"),S=b("/img/open-icon.svg"),ne=b("/img/robot-icon.svg"),Mt=b("/img/help-icon.svg"),xt=b("/img/open-popup-icon.svg"),Ot=b("/img/setting-disable-icon.svg"),Se=b("/img/done-icon.svg"),ie=A=>{i&&(i.classList.add("_ATBE_alerts-item_hide"),!D&&A&&chrome.runtime.sendMessage({resend:{visualAlertClose:r}}),setTimeout(()=>{i&&i.remove(),i=null},a.get("config.transitionDelay")))};l?(()=>{const A=a.get("config.luckyFactorPredict"),v="https://www.twitch.tv/",h=s.status,g=s.data,L=o==="predictions"?h===0?"predictionsStart":"predictionsResult":o,q=je(L),M=o==="raids"&&p("alert_raids")||o==="predictions"&&p(h===0?"alert_predictionsStart":"alert_predictionsResult")||o==="reloads"&&p("alert_reloads")||p("stat_unknown"),Be=o==="raids"&&p("alert_raidsDescr")||o==="predictions"&&p(h===0?"alert_predictionsDescrStart":h===1?"alert_predictionsDescrWin":h===2?"alert_predictionsDescrLose":"alert_predictionsDescrRefund")||o==="reloads"&&p("alert_reloadsDescr")||"",C=o==="raids"&&`${v}${g.to.login}`||o==="predictions"&&(g.login?Ae(g.login):v)||o==="reloads"&&g.page||"",ke=o==="raids"&&g.to.displayName||o==="predictions"&&(h===0?g.title:`${h===1?g.pointsWon:g.points} ${p("alert_pointsVar")}`)||o==="reloads"&&Nt(g.page)||p("stat_unknown"),$e=["raids","predictions"].includes(o)&&`${v}${g.login||""}`||"",Ft=["raids","predictions"].includes(o)&&g.displayName||p("stat_unknown"),ct=g.pointsWon&&(g.pointsWon/g.points).toFixed(1),Le=["playbackError","integrityFail"].includes(g.reloadType),Ut=o==="predictions"&&h===0&&p("alert_predictionsDescrOutcomes")||o==="reloads"&&p("alert_reloadsDescrReason")||"";let j="";Array.isArray(g.outcomes)?g.outcomes.forEach((Pe,Ht)=>{Ht&&(j+=", "),j+=`<b class="_ATBE_color _ATBE_color_${Pe.color&&Pe.color.toLowerCase()}">${Pe.title}</b>`}):g.hasOwnProperty("reloadType")&&(j=`<b class="_ATBE_color _ATBE_color_warn">${Le&&p(`alert_reloadsDescr${Rt(g.reloadType)}`)||p("stat_unknown")}</b>`),n+='<div class="_ATBE_alerts-item__header">',n+=`<span class="_ATBE_alerts-item__title" style="--ATBE-bg-img:url(${w})">${M}</span>`,n+=`<button class="_ATBE_alerts-item__cancel" style="--ATBE-bg-img:url(${_})"></button>`,n+=`<button class="_ATBE_alerts-item__close" style="--ATBE-bg-img:url(${y})"></button></div>`,n+=`<div class="_ATBE_alerts-item__body"><span class="_ATBE_alerts-item__descr">${Be}</span>`,C&&(n+=`&nbsp;<a class="_ATBE_alerts-item__link" target="_blank" rel="noreferrer" href="${C}">${ke}<span class="_ATBE_alerts-item__link-icon" style="--ATBE-bg-img:url(${S})"></span></a>`),j&&(n+=`<div class="_ATBE_alerts-item__descr2">${Ut} ${j}</div>`),o==="predictions"&&h===1&&(n+=`<div class="_ATBE_alerts-item__descr2">${p("alert_winFactor")} <b class="_ATBE_color">x${ct}</b></div>`),o==="predictions"&&h===0&&g.login&&g.displayName&&(n+=`<button class="_ATBE_alerts-item__btn" data-param="${g.login}" data-param2="${g.displayName}" data-type="predict" style="--ATBE-icon-img:url(${xt});--ATBE-icon-done-img:url(${Se})">${p("alert_openPrediction")}</button>`),o==="reloads"&&Le&&(n+=`<button class="_ATBE_alerts-item__btn _ATBE_alerts-item__btn_setting" data-param="${g.reloadType}" data-type="disable" style="--ATBE-icon-img:url(${Ot});--ATBE-icon-done-img:url(${Se})">${p("alert_reloadDisable")}</button>`),o==="reloads"&&Le&&(n+=`<button class="_ATBE_alerts-item__btn _ATBE_alerts-item__btn_help" data-param="${g.reloadType==="playbackError"&&"errors_playback"||g.reloadType==="integrityFail"&&"errors_integrity"||""}" data-type="help" style="--ATBE-icon-img:url(${Mt});--ATBE-icon-done-img:url(${Se})">${p("alert_learnMore")}</button>`),o==="predictions"&&h===1&&ct>=A&&(n+=`<div class="_ATBE_alerts-item__warn">${p("alert_criticalLuck")}</div>`),o==="raids"&&g.canceled&&(n+=`<div class="_ATBE_alerts-item__warn">${p("alert_raidsCanceled")}</div>`),n+=`</div><div class="_ATBE_alerts-item__timer" style="--ATBE-duration:${c}s" data-time="${E()}"></div>`,u?n+=`<div class="_ATBE_alerts-item__footer _ATBE_alerts-item__footer_automation" style="--ATBE-bg-img:url(${ne})"><i>${p("alert_extAutomation")}</i></div>`:(n+=`<a class="_ATBE_alerts-item__footer" target="_blank" rel="noreferrer" href="${$e}">${m&&p("alert_forChannel")||""} `,n+=`<b>${Ft}</b><span class="_ATBE_alerts-item__footer-icon" style="--ATBE-bg-img:url(${S})"></span></a>`),n+=`<div class="_ATBE_alerts-item__settings${q?" _ATBE_alerts-item__settings_active":""}"><button class="_ATBE_alerts-item__btn-disable-all">${p("alert_disableAll")}</button><button class="_ATBE_alerts-item__btn-disable-this" data-type="${L}">${p("alert_disableThis")}</button></div>`,i.classList.add("_ATBE_alerts-item_event")})():(()=>{const A=a.get("config.dropsTag"),v=a.get("config.hashDrop"),h="https://www.twitch.tv/",g=je(o),L=s.benefit&&s.benefit.imageAssetURL||s.image||s.thumbnailURL||b(`/img/${o}-icon.svg`),q=s.benefit&&s.benefit.name||o==="points"&&(s.pointsName||p("alert_pointsVar"))||o==="moments"&&s.title||p("stat_unknown"),M=o==="drops"&&`${p("alert_drop")} ${p("alert_claimedOne")}`||o==="moments"&&`${p("alert_moment")} ${p("alert_claimedOne")}`||o==="points"&&`${s.points||"?"} ${p("alert_points")} ${p("alert_claimedMany")}`||p("stat_unknown"),Be=s.game&&s.game.name||s.displayName||s.broadcaster&&s.broadcaster.displayName||null,C=encodeURIComponent(s.game&&s.game.name||s.login||s.broadcaster&&s.broadcaster.login||""),ke=o==="drops"&&`directory/game/${C}?${A}`||o==="points"&&C||o==="moments"&&C||"",$e=o==="drops"&&`${h}drops/inventory${v}${encodeURIComponent(q)}`||o==="points"&&(C?Ae(C):h)||o==="moments"&&`https://clips.twitch.tv/${s.slug||""}`||"";n+='<div class="_ATBE_alerts-item__header">',n+=`<span class="_ATBE_alerts-item__title" style="--ATBE-bg-img:url(${w})">${M}</span>`,n+=`<button class="_ATBE_alerts-item__cancel" style="--ATBE-bg-img:url(${_})"></button>`,n+=`<button class="_ATBE_alerts-item__close" style="--ATBE-bg-img:url(${y})"></button></div>`,n+=`<a class="_ATBE_alerts-item__body" target="_blank" rel="noreferrer" href="${$e}">`,n+=`<span class="_ATBE_alerts-item__body-icon" style="--ATBE-bg-img:url(${S})"></span><img class="_ATBE_alerts-item__img" src="${L}" alt="${q}" data-type="${o}"/>`,o==="points"&&(n+=`<div class="_ATBE_alerts-item__modifier">&#215;${s.points||"?"}</div>`),n+=`<div class="_ATBE_alerts-item__name">${q}</div></a><div class="_ATBE_alerts-item__timer" style="--ATBE-duration:${c}s" data-time="${E()}"></div>`,n+=`<a class="_ATBE_alerts-item__footer" target="_blank" rel="noreferrer" href="${h}${ke}">`,n+=`${o==="drops"&&p("alert_forGame")||m&&p("alert_forChannel")||""} `,n+=`<b>${Be||p("stat_unknown")}</b>`,n+=`<span class="_ATBE_alerts-item__footer-icon" style="--ATBE-bg-img:url(${S})"></span></a>`,n+=`<div class="_ATBE_alerts-item__settings${g?" _ATBE_alerts-item__settings_active":""}"><button class="_ATBE_alerts-item__btn-disable-all">${p("alert_disableAll")}</button><button class="_ATBE_alerts-item__btn-disable-this" data-type="${o}">${p("alert_disableThis")}</button></div>`,i.classList.add("_ATBE_alerts-item_claim")})(),i.classList.add("_ATBE_alerts-item"),i.classList.add(`_ATBE_alerts-item_${o}`),i.dataset.id=r,i.innerHTML=n;const tt=i.querySelector("._ATBE_alerts-item__close");tt&&tt.addEventListener("click",ie);const nt=i.querySelector("._ATBE_alerts-item__cancel"),it=i.querySelector("._ATBE_alerts-item__settings");nt&&nt.addEventListener("click",()=>{it&&it.classList.toggle("_ATBE_alerts-item__settings_active")});const st=i.querySelector("._ATBE_alerts-item__btn-disable-all");st&&st.addEventListener("click",()=>{const A=a.get("settings.alerts");Object.keys(A).forEach(v=>{ge(`alerts.${v}.visual`)}),document.querySelectorAll("._ATBE_alerts-item__close").forEach(v=>v.click()),chrome.runtime.sendMessage({analytics:{name:"alert_setting",params:{kind:"alerts.[*].visual",value:!1}}})});const at=i.querySelector("._ATBE_alerts-item__btn-disable-this");at&&at.addEventListener("click",A=>{const h=`alerts.${A.target.dataset.type}.visual`;ge(h),ie(!0),chrome.runtime.sendMessage({analytics:{name:"alert_setting",params:{kind:h,value:!1}}})});const ot=i.querySelectorAll("._ATBE_alerts-item__btn");ot&&et(ot,"click",A=>{const v=A.target,h=v.dataset,g=h.type,L=h.param,q=()=>{v.disabled=!0,v.classList.add("_ATBE_alerts-item__btn_done")};if(L){if(g==="help")It(L),chrome.runtime.sendMessage({analytics:{name:"alert_open",params:{page:"Help"}}});else if(g==="predict")q(),ie(!0),yt(L,h.param2),chrome.runtime.sendMessage({analytics:{name:"alert_open",params:{page:"Prediction"}}});else if(g==="disable"){q();const M={playbackError:"autoReload",integrityFail:"integrityReload"};ge(M[L]),chrome.runtime.sendMessage({analytics:{name:"alert_setting",params:{kind:`settings.${M[L]}`,value:!1}}})}}});const rt=i.querySelectorAll("._ATBE_alerts-item__img");rt&&et(rt,"error",A=>{const v=A.target,h=v.dataset;v.src=b(`/img/${h.type}-icon.svg`)}),t.prepend(i),setTimeout(()=>{i&&i.classList.add("_ATBE_alerts-item_show"),setTimeout(ie,c*1e3)},0)}function je(e){const t=a.get("state.visualAlertsShown");return t.includes(e)?!1:(setTimeout(()=>{t.push(e),a.set("state.visualAlertsShown",t)},a.get("config.defaultDelay")),!0)}function ge(e){e&&a.set(`settings.${e}`,!1)}function ht(e){const t=document.querySelector(`._ATBE_alerts-item[data-id="${e}"]`);t&&(t.classList.add("_ATBE_alerts-item_hide"),setTimeout(()=>{t&&t.remove()},a.get("config.transitionDelay")))}function yt(e,t){const n=We();if(!n||!e)return;const i=b("/icon/appicon_16.png"),s=b("/img/close-icon.svg"),o=t?` ${p("alert_forChannel").toLowerCase()} ${t}`:"",r=Ae(e,!0);let c=document.createElement("div"),l=`<div class="_ATBE_alerts-item__header"><span class="_ATBE_alerts-item__title" style="--ATBE-bg-img:url(${i})">${p("alert_predictionsVar")}${o}</span>`;l+=`<button class="_ATBE_alerts-item__close" style="--ATBE-bg-img:url(${s})"></button></div>`,l+=`<div class="_ATBE_alerts-item__overlay"><iframe class="_ATBE_alerts-item__iframe" src="${r}" sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox" allow="encrypted-media *"/></div>`,c.classList.add("_ATBE_alerts-item"),c.classList.add("_ATBE_alerts-item_overlay"),c.innerHTML=l,c.querySelector("._ATBE_alerts-item__close").addEventListener("click",()=>{c.classList.add("_ATBE_alerts-item_hide"),setTimeout(()=>{c&&c.remove(),c=null},a.get("config.transitionDelay"))}),n.prepend(c),setTimeout(()=>{c.classList.add("_ATBE_alerts-item_show")},0),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Prediction_Popup",page_location:"/twitch/prediction-popup"}}})}function We(){let e=document.querySelector("._ATBE_alerts");if(!e){const t=document.querySelector(a.get("config.querySelectors.playerContainer"))||document.querySelector(a.get("config.querySelectors.mainContainer"));if(!t)return null;e=document.createElement("div"),e.classList.add("_ATBE_alerts"),t.append(e)}return Ve(e),e}function Ve(e){const t=document.querySelector(a.get("config.querySelectors.playerEvents"));fe(),!(!e||!t)&&(U=new ResizeObserver(()=>{if(!e||!t||!t.offsetTop&&!t.offsetHeight)return fe();const n=t.offsetHeight?12:0;e.style.top=`${t.offsetTop+t.offsetHeight+n}px`,e.style.maxHeight=`calc(100% - ${t.offsetTop+t.offsetHeight+50+n}px)`}),U.observe(t))}function fe(){U&&U.disconnect(),U=null;const e=document.querySelector("._ATBE_alerts");e&&(e.style.top=null,e.style.maxHeight=null)}function I(e,t){const n=a.get(`config.${e}Maxlength`);t.length>n&&(t=t.slice(0,n)),a.set(e,t,i=>{i==="QUOTA_BYTES_PER_ITEM quota exceeded"&&(t.pop(),I(e,t))})}function P(e){if(e){_t(),T.beforeCheckTime=E(),clearTimeout(V),V=setTimeout(P,e);return}const t=document.querySelector(a.get("config.querySelectors.playerElement")),n=()=>{if(!a.get("settings.autoReload")||!Ze("config.reloadErrorDelay")){P(a.get("config.playerHealthDelay"));return}const o=Math.round((s-a.get("config.playerHealthDelayMax"))/1e3),r=J(T);r.reloadTimeout=o>0?o:0,delete r.beforeCheckTime,f(new Error(`RELOAD: ${JSON.stringify(r)}`),"checkPlayerHealth"),Y("playbackError")},i=()=>(T.playbackFailedTimes++,T.playbackFailedTimes>=a.get("config.playbackFailedMax")?n():P(a.get("config.waitPlayerError"))),s=E()-T.beforeCheckTime;if(clearTimeout(V),!d.playerFit||!t||!a.get("settings.autoReload"))return T.playbackFailedTimes=0,T.fetchFailedTimes=0,P(a.get("config.playerHealthDelay"));if(T.fetchFailedTimes>=a.get("config.fetchFailedMax"))return n();if(s>=a.get("config.playerHealthDelayMax"))return document.hidden?n():P(a.get("config.playerHealthDelay"));if(!t.ended&&!t.paused&&![0,4].includes(t.readyState)||t.buffered.length>3||t.paused&&[2,3].includes(t.readyState)&&t.currentTime>10&&t.buffered.length>0)return i();T.playbackFailedTimes=0,P(a.get("config.playerHealthDelay"))}function Qe(){T.fetchFailedTimes++,clearTimeout(ce),ce=setTimeout(()=>{T.fetchFailedTimes=0},a.get("config.resetFetchFailedDelay")),P(a.get("config.waitPlayerError"))}function _t(){const e=document.querySelector(a.get("config.querySelectors.playerOverlay"));if(!e)return he();e!==ue&&(he(),ue=e,x=new MutationObserver(t=>{d.playerFit&&t.forEach(n=>{const s=n.addedNodes&&n.addedNodes[0]&&e.querySelector(a.get("config.querySelectors.playerErrorButton"));!s||!a.get("settings.autoReload")||(T.playbackFailedTimes=0,T.fetchFailedTimes=0,s.click(),chrome.runtime.sendMessage({analytics:{name:"player_event",params:{kind:"reload_button"}}}))})}),x.observe(e,{childList:!0}))}function he(){x&&x.disconnect(),x=null,ue=null}function vt(){let e=document.readyState==="loading";e?document.addEventListener("DOMContentLoaded",t):t();function t(){setTimeout(()=>{ye(e),P(a.get("config.defaultDelay"))},a.get("config.defaultDelay"))}}function ye(e){clearTimeout(re),_e()?k(!1,!0).then(i=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:i,body:JSON.stringify([{operationName:"UseLive",extensions:{persistedQuery:{sha256Hash:"639d5f11bfb8bf3053b424d9ef650d04c4ebb7d94711d644afb08fe9a0fad5d9",version:1}},variables:{channelLogin:we()}}])}).then(s=>s.json()).then(s=>{try{if($(s,"getLivestream")){n(!1),N();return}const o=s[0].data.user.stream;d.videoElement=document.querySelector(a.get("config.querySelectors.playerElement")),o&&d.videoElement&&_e()?(n(!0),bt(),t()):(n(!1),N())}catch{n(!1),N()}}).catch(s=>{if(s.message==="Failed to fetch")return Qe();throw n(!1),N(),s})}).catch(i=>{f(i,"getLivestream")}):(n(!1),N()),re=setTimeout(ye,a.get("config.checkLiveDelay"));function t(){Lt(),e&&($t(),e=!1)}function n(i){d.playerFit!==i&&(d.playerFit=i,d.playerFit,void 0)}}function _e(e){const t=e||location;return t.host==="player.twitch.tv"?new URL(t.href).searchParams.has("channel"):t.pathname.match(/\/clip\//)?!1:!["","videos","directory","subscriptions","drops","wallet","settings","embed","popout"].includes(t.pathname.split("/")[1])}function ve(e){const t=new URL((e||location).href);return!!t.searchParams&&t.searchParams.get(a.get("config.queryRaid"))==="raid"}function be(){location.href!==d.pageUrl&&(d.prevUrl=d.pageUrl,d.pageUrl=location.href,Et(new URL(d.pageUrl),new URL(d.prevUrl)))}function z(e){d.playerActive!==e&&(d.playerActive=e,wt(d.playerActive))}function B(){if(!d.videoElement){z(!1);return}setTimeout(()=>{z(!!(d.videoElement&&d.videoElement.currentTime>0&&!d.videoElement.paused&&!d.videoElement.ended))},a.get("config.shortDelay"))}function bt(){if(!d.videoElement){z(!1);return}N(),d.videoElement.addEventListener("play",B),d.videoElement.addEventListener("pause",B),d.videoElement.addEventListener("ended",B),d.videoElement.addEventListener("error",B),d.videoElement.addEventListener("abort",B),B()}function N(){z(!1),d.videoElement&&(d.videoElement.removeEventListener("play",B),d.videoElement.removeEventListener("pause",B),d.videoElement.removeEventListener("ended",B),d.videoElement.removeEventListener("error",B),d.videoElement.removeEventListener("abort",B))}function Et(e,t){ye(),At(e,t),P(a.get("config.defaultDelay")),Tt(),Z()}function jt(e){}function wt(e){a.get("settings.changeIcon")&&K(e&&!ve())}function Tt(){const e=document.querySelector("._ATBE_alerts");e&&setTimeout(()=>{const t=document.querySelector(a.get("config.querySelectors.playerContainer"))||document.querySelector(a.get("config.querySelectors.mainContainer"));if(t&&e.parentElement!==t){t.append(e);const n=e.querySelectorAll("._ATBE_alerts-item__timer")||[],i=E();for(const s of n){const o=Math.round((i-s.dataset.time)/1e3),c=(s.style.getPropertyValue("--ATBE-duration")||"0s").slice(0,-1)-o;s.style=`--ATBE-duration:${c}s`,s.dataset.time=i}}Ve(e)},a.get("config.waitRenderDelay"))}function At(e,t){if(!a.get("settings.enabled")||!ve(e))return;const n=a.get("settings.cancelRaid"),i=a.get("lastRaids"),s=history.state&&history.state.state&&history.state.state.raid_id||ee(),o=i.some(r=>{if(r.id===s)return!0});n&&setTimeout(()=>{e.searchParams.delete(a.get("config.queryRaid")),history.replaceState(history.state,null,e.href),setTimeout(()=>{history.back(),Ye(e.href)},a.get("config.waitRenderDelay"))},a.get("config.activateWindowDelay")),!o&&Promise.all([G(t.href),G(e.href)]).then(r=>{const c={type:"raids",id:s,status:n?1:0,timestamp:E(),data:{canceled:n,login:r[0].login,displayName:r[0].displayName,to:{login:r[1].login,displayName:r[1].displayName}}};i.unshift(c),I("lastRaids",i),chrome.runtime.sendMessage({analytics:{name:"twitch_event",params:{kind:"raids",value:1}}})}).catch(r=>{f(r,"checkRaid")})}function St(e){if(!a.get("settings.enabled")||!e||!e.id)return;const t=`${e.id}-0`,n=i=>{try{const s=a.get("lastPredictions"),o=s.some(c=>{if(c.id===t)return!0}),r={type:"predictions",id:t,status:0,timestamp:E(),data:Object.assign(JSON.parse(JSON.stringify(e)),{login:i.login,displayName:i.displayName,outcomes:e.outcomes.map(c=>({id:c.id,title:c.title,color:c.color}))})};if(delete r.data.created_by,delete r.data.ended_at,delete r.data.ended_by,delete r.data.locked_at,delete r.data.locked_by,delete r.data.winning_outcome_id,o)return;s.unshift(r),I("lastPredictions",s),chrome.runtime.sendMessage({analytics:{name:"twitch_event",params:{kind:"predictions",action:"start",value:1}}})}catch(s){f(s,"checkPredictionActive")}};W.includes(t)||(W.push(t),Ee(e.channel_id).then(i=>{G(null,i).then(n)}).catch(i=>{f(i,"checkPredictionActive")}))}function Bt(e){if(!a.get("settings.enabled")||!e||!e.event_id||!e.channel_id||!e.result)return;const t=e.result.points_won||0,n=e.result.type,i=n==="WIN"?1:n==="LOSE"?2:3,s=`${e.event_id}-${i}`,o=r=>{try{const c=a.get("lastPredictions"),l=c.some(u=>{if(u.id===s)return!0}),m={type:"predictions",id:s,status:i,timestamp:E(),data:{login:r.login,displayName:r.displayName,id:e.event_id,outcome_id:e.outcome_id,channel_id:e.channel_id,updated_at:e.updated_at,status:n,points:e.points,pointsWon:t}};if(l)return;c.unshift(m),I("lastPredictions",c),chrome.runtime.sendMessage({analytics:{name:"twitch_event",params:{kind:"predictions",action:"result",value:t}}})}catch(c){f(c,"checkPredictionResult")}};W.includes(s)||(W.push(s),Ee(e.channel_id).then(r=>{G(null,r).then(o)}).catch(r=>{f(r,"checkPredictionResult")}))}function G(e,t){const n={login:null,id:null,displayName:null,primaryColorHex:null,profileImageURL:null};return new Promise(i=>{if(n.login=t||we(e),!n.login){i(n);return}k().then(s=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:s,body:JSON.stringify([{operationName:"ChannelShell",extensions:{persistedQuery:{sha256Hash:"580ab410bcd0c1ad194224957ae2241e5d252b2c5173d8e0cce9d32d5bb14efe",version:1}},variables:{login:n.login}}])}).then(o=>o.json()).then(o=>{if($(o,"getChannelData")){i(n);return}n.id=o[0].data.userOrError.id,n.displayName=o[0].data.userOrError.displayName,n.primaryColorHex=o[0].data.userOrError.primaryColorHex,n.profileImageURL=o[0].data.userOrError.profileImageURL,i(n)}).catch(()=>{i(n)})}).catch(()=>{i(n)})}).catch(i=>{f(i,"getChannelData")})}function Ee(e){return new Promise((t,n)=>{k().then(i=>{fetch("https://gql.twitch.tv/gql",{method:"post",headers:i,body:JSON.stringify([{operationName:"ChannelPanels",extensions:{persistedQuery:{sha256Hash:"c388999b5fcd8063deafc7f7ad32ebd1cce3d94953c20bf96cffeef643327322",version:1}},variables:{id:e}}])}).then(s=>s.json()).then(s=>{if($(s,"getChannelLogin")){n();return}const o=s[0].data.user.login;if(!o){n();return}t(o)}).catch(()=>{n()})}).catch(i=>{f(i,"getChannelLogin")})})}function K(e){const t=document.querySelector(a.get("config.querySelectors.favicon16")),n=document.querySelector(a.get("config.querySelectors.favicon32"));if(!t||!n)return f("Favicon not found","changeIcon");const i=t.dataset.default,s=n.dataset.default,o=e?b("/img/twitch-icon-red-16.png"):i,r=e?b("/img/twitch-icon-red-32.png"):s;(!i||!s)&&(t.dataset.default=t.href,n.dataset.default=n.href),o&&r&&(t.href=o,n.href=r)}function ze(e){const t=document.createElement("script");t.innerHTML=`(function () {${e.toString().replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm," ").replace(/[\r\n]+/g," ").replace(/\s\s+/g," ").trim().match(/^.*?{(.+)}.*$/)[1]}})('${Ce}');`,De.prepend(t)}function kt(){const e=document.cookie.match(/(?:^|; )auth-token=([^;]*)/);return e?`OAuth ${e[1]}`:void 0}function $t(){if(D||!d.playerFit||d.playerActive||!a.get("settings.autoStart"))return;const e=()=>{try{Object.defineProperty(window.document,"hidden",{get:()=>!1,configurable:!0}),Object.defineProperty(window.document,"visibilityState",{get:()=>"visible",configurable:!0}),window.document.dispatchEvent(new Event("visibilitychange")),setTimeout(()=>{delete window.document.hidden,delete window.document.visibilityState},1e3)}catch{}},t=n=>{n&&d.videoElement.play().catch(()=>t(--n))};ze(e),chrome.runtime.sendMessage("activateTab"),t(300)}function Lt(){if(D||!d.playerFit||!d.videoElement||!d.videoElement.muted||d.videoElement._ATBE_activated||!a.get("settings.preventPause"))return;let e=a.get("config.unmuteRetries");const t=.011,n=()=>{d.videoElement.volume!==t&&(r=d.videoElement.volume,d.videoElement.volume=t)},i=()=>{s()&&(document.removeEventListener("visibilitychange",i),o(!0))},s=()=>document.visibilityState==="visible",o=c=>{if(!(!d.videoElement||!d.videoElement.muted)){if(!c&&(d.videoElement.paused||!d.videoElement.currentTime)){e&&(setTimeout(o,a.get("config.unmutePlayerDelay")),e--);return}d.videoElement.volume=t,d.videoElement.muted=!1,d.videoElement.addEventListener("volumechange",n),setTimeout(()=>{d.videoElement&&(d.videoElement.removeEventListener("volumechange",n),d.videoElement.muted=!0,d.videoElement.volume=r,d.videoElement._ATBE_activated=!0)},a.get("config.unmutePlayerDelay"))}};let r=d.videoElement.volume;s()?o():document.addEventListener("visibilitychange",i)}function we(e){const t=new URL(e||location.href);return t.host==="player.twitch.tv"?t.searchParams.get("channel")||"":t.pathname.split("/")[1]}function b(e){try{return chrome.runtime.getURL(e)}catch{}}function Ge(e){setTimeout(Y,typeof e=="number"?e:a.get("config.reloadDelay"))}function Ke(){const e=location.pathname.split("/"),t=location.hash===a.get("config.hashPointsFs"),n=location.hash===a.get("config.hashPointsFsP"),i=a.get("config.hashDrop"),s=()=>{const r=document.querySelector(a.get("config.querySelectors.pointsButton")),c=new MutationObserver(l=>{l.some(m=>{if(m.removedNodes&&m.removedNodes.length)return document.body.classList.remove("_ATBE_points-fs"),document.body.classList.remove("_ATBE_points-fs_predict"),r.disabled=!1,c.disconnect(),!0})});if(!r){setTimeout(s,a.get("config.activateWindowDelay"));return}if(r.click(),r.disabled=!0,n)setTimeout(()=>{const l=document.querySelector(a.get("config.querySelectors.predictionsButton"));l&&l.click()},a.get("config.shortDelay"));else{const l=document.querySelector(a.get("config.querySelectors.pointsSummary"));l&&l.parentElement&&c.observe(l.parentElement,{subtree:!1,childList:!0})}},o=()=>{const r=decodeURIComponent(location.hash.slice(i.length)).replace(/&/g,"&amp;"),c=document.querySelectorAll(a.get("config.querySelectors.dropsName"));if(!c.length){setTimeout(o,a.get("config.activateWindowDelay"));return}[].some.call(c,l=>{if(l.innerHTML===r){let m=l;for(;m;){const u=m.parentElement;if(u&&u.matches(a.get("config.querySelectors.dropsWrapper")))break;m=u}return m&&(m.classList.add("_ATBE_drop-highlight"),m.scrollIntoView({behavior:"smooth",block:"center"})),!0}})};if(location.host==="www.twitch.tv"){if(!document.body)return setTimeout(Ke,a.get("config.shortDelay"));if((t||n)&&e[1]&&["popout","embed"].includes(e[1])&&e[3]&&e[3]==="chat"){document.body.classList.add("_ATBE_points-fs"),n&&document.body.classList.add("_ATBE_points-fs_predict"),s(),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Points_View",page_location:"/twitch/points-view"}}});return}location.hash.slice(0,i.length)===i&&e[1]&&e[1]==="drops"&&e[2]&&e[2]==="inventory"&&(o(),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Drops_View",page_location:"/twitch/drops-view"}}}))}}function Pt(){const e=t=>{const n=document.querySelector(`.${t}`);n&&n.classList.remove(t)};e("_ATBE_points-fs_predict"),e("_ATBE_points-fs"),e("_ATBE_drop-highlight")}function X(){const e="_ATBE_hide-extensions";if(!document.body)return setTimeout(X,a.get("config.shortDelay"));if(!D&&a.get("settings.enabled")&&a.get("settings.hideExtensions")){document.body.classList.add(e);return}document.body.classList.remove(e)}function Te(){let e=null,t=null,n=200;const i="_ATBE_nav-popup-preview",s="_ATBE_nav-popup-preview_hidden",o=y=>{const _=e;fetch(`https://static-cdn.jtvnw.net/previews-ttv/live_user_${e}-320x180.jpg`).then(S=>S.blob()).then(S=>{_===e&&(y.src=URL.createObjectURL(S),y.classList.remove(s))})},r=()=>{const y=t&&t.querySelector(a.get("config.querySelectors.navPopupBody"));if(!y||!e)return;let _=y.querySelector(`.${i}`);if(_){o(_);return}_=document.createElement("img"),_.classList.add(i),o(_),y.append(_)},c=y=>{e=y.target.href.split("/").pop(),r()},l=()=>{const y=t&&t.querySelector(a.get("config.querySelectors.navPopupBody"));if(!y)return;const _=y.querySelector(`.${i}`);_&&_.classList.add(s)},m=()=>{const y=document.querySelectorAll(a.get("config.querySelectors.navLinks"));for(const _ of y)H(_,"mouseenter",c,se),H(_,"mouseleave",l,se)},u=()=>{const y=document.querySelector(a.get("config.querySelectors.navWrapper"));if(!y){n--,n&&setTimeout(u,a.get("config.shortDelay"));return}m(),O=new MutationObserver(m),O.observe(y,{childList:!0,subtree:!0}),F=new MutationObserver(_=>{_.forEach(S=>{if(S.addedNodes&&S.addedNodes.length){for(const ne of S.addedNodes)if(ne.classList.contains(a.get("config.querySelectors.navPopup").slice(1))){t=ne,r();break}}})}),F.observe(document.body,{childList:!0,subtree:!1})};(()=>{Ct(se),O&&O.disconnect(),O=null,F&&F.disconnect(),F=null})(),!D&&a.get("settings.enabled")&&a.get("settings.showPreviews")&&u()}function Xe(){try{chrome.runtime.sendMessage("PING")}catch(e){e.message==="Extension context invalidated."&&(me(),Ge())}Ne=setTimeout(Xe,a.get("config.playerHealthDelay"))}function Dt(){if(localStorage.setItem("mature","true"),localStorage.setItem("channelPointsOnboardingDismissed","true"),location.hostname==="www.twitch.tv"&&location.pathname.slice(0,7)==="/embed/"){const e=new URL(location.href);localStorage.getItem("twilight.theme")!=="0"&&!e.searchParams.has("darkpopout")&&(e.searchParams.append("darkpopout",""),location.href=e)}}function k(e,t){let n=200,i=!1;const s=kt(),o=localStorage.getItem("local_storage_app_session_id"),r=localStorage.getItem("local_copy_unique_id"),c={"Client-Id":a.get("clientId"),"Client-Version":a.get("clientVersion"),"Client-Session-Id":o&&JSON.parse(o)||ee(16),"X-Device-Id":r&&JSON.parse(r)},l=()=>{window.postMessage({autoTwitchBrowserExtensionIntegrity:c},"*")};return s&&(c.Authorization=s),e&&(R=null),new Promise((m,u)=>{try{const w=E(),y=()=>{if(!n--)return u("Max tries exceeded while getting integrity token");if(R&&R.token&&R.expiration>E())return c["Client-Integrity"]=R.token,m(c);i||(Re+1e3<w&&(Re=w,l()),i=!0),setTimeout(y,100)};if(!s&&!t||!r)return u("No authorization");y()}catch(w){f(w,"getHeaders")}})}function Y(e){if(a.get("settings.enabled")){if(e){const t=new URL(location.href);t.searchParams.set(a.get("config.queryReload"),e),location.href=t.href;return}try{f(new Error("RELOAD: system"),"processReload")}catch{}location.reload()}}function Ye(e){const t=new URL(location.href),n=t.searchParams.get(a.get("config.queryReload")),i=typeof n=="string"||e,s=l=>{clearTimeout(de),de=setTimeout(()=>{if(!r&&document.querySelector(a.get("config.querySelectors.mainContainer"))){r=!0;const u=a.get("lastReloads");u.unshift({type:"reloads",timestamp:E(),id:ee(24),status:1,data:{reloadType:n,page:t.href}}),I("lastReloads",u)}const m=document.querySelector(a.get("config.querySelectors.offlineChannelHeader"));c||(m?(c=!0,e&&history.replaceState(history.state,null,e),m.click()):document.querySelector(a.get("config.querySelectors.aboutSection"))&&(c=!0)),o++,o<20&&(!r||!c)&&s()},l||a.get("config.transitionDelay"))};let o=0,r=!!e,c=!1;i&&(t.searchParams.delete(a.get("config.queryReload")),history.replaceState(history.state,null,t.href),document.readyState==="complete"?s():document.addEventListener("DOMContentLoaded",()=>s(a.get("config.reloadDelay"))))}function Ae(e,t){const n="https://www.twitch.tv/embed/",i=a.get("config.hashPointsFs"),s=a.get("config.hashPointsFsP");let o="parent=www.twitch.tv&parent=player.twitch.tv";if(t){const r=new URL(location.href).searchParams.getAll("parent");r&&r.forEach(c=>{o+=`&parent=${c}`})}return`${n}${e}/chat?${o}${t?s:i}`}function Z(){let e=200,t=null,n=document.querySelector(a.get("config.querySelectors.playerClicker"));const i=()=>{if(!n){--e&&(n=document.querySelector(a.get("config.querySelectors.playerClicker")),setTimeout(i,a.get("config.shortDelay")));return}let o=document.querySelector("._ATBE_pause-icon");if(!o){const r=document.querySelector(a.get("config.querySelectors.playerContainer"));if(!r)return;o=document.createElement("div"),o.classList.add("_ATBE_pause-icon"),o.style.setProperty("--ATBE-icon-pause",`url(${b("/img/pause-icon.svg")})`),r.append(o)}H(n,"mousedown",r=>{r.button===0&&(t=Date.now(),o.classList.add("_ATBE_pause-icon_active"))}),H(n,"mouseup",r=>{if(r.button===0&&t&&Date.now()>t+500){const c=document.querySelector(a.get("config.querySelectors.playerElement"));c&&!c.ended&&!c.paused&&c.pause()}t=null,o.classList.remove("_ATBE_pause-icon_active")}),H(n,"mouseleave",()=>{t=null,o.classList.remove("_ATBE_pause-icon_active")})};(()=>{n&&(te(n,"mousedown"),te(n,"mouseup"),te(n,"mouseleave"),n=null,t=null)})(),!D&&a.get("settings.enabled")&&a.get("settings.clickPause")&&i()}function It(e){chrome.runtime.sendMessage({openHelp:!0,section:e})}function qt(){if(d.integrityFailed++,clearTimeout(le),a.get("settings.integrityReload")&&d.integrityFailed>=a.get("config.integrityFailedMax")&&Ze("config.reloadAutoDelay"))return f(new Error(`RELOAD: {"integrityFailed":${d.integrityFailed}}`),"processIntegrityFailed"),Y("integrityFail");le=setTimeout(()=>{d.integrityFailed=0},a.get("config.resetIntegrityFailedDelay")),k(!0)}function f(e,t){console.group(`%c ATBE PROCESS INFO (${new Date().toLocaleTimeString()}) [${t||"-"}] `,"color: white; background: blue;"),console.info(e),console.groupEnd();const n=e.toString();["No authorization","error: Max tries exceeded"].includes(n)||chrome.runtime.sendMessage({analytics:{name:"extension_error",params:{message:`${e.message||n} [${t||"-"}]`}}}),n==="Error: CRITICAL: failed integrity check"&&qt()}function $(e,t){return e&&e[0]&&e[0].errors&&e[0].errors[0]?(f(new Error(`CRITICAL: ${e[0].errors[0].message}`),t),!0):!1}function E(){return new Date().getTime()}function Ze(e){return lt+a.get(e)<E()}function ee(e){const t="abcdefghijklmnopqrstuvwxyz0123456789",n=t.length,i=e||10;let s="";for(var o=0;o<i;o++)s+=t.charAt(Math.floor(Math.random()*n));return s}function H(e,t,n,i){e.addEventListener(t,n),e._ate_listeners=e._ate_listeners||{},e._ate_listeners[t]=e._ate_listeners[t]||[],e._ate_listeners[t].push(n),i&&i.push(e)}function te(e,t){const n=i=>{e._ate_listeners[i]&&e._ate_listeners[i].forEach(s=>{e.removeEventListener(i,s)})};if(e._ate_listeners){if(t){n(t),delete e._ate_listeners[t];return}Object.keys(e._ate_listeners).forEach(n),e._ate_listeners={}}}function Ct(e){e.forEach(t=>{te(t)}),e.length=0}function et(e,t,n){!e||!e.length||e.forEach(i=>i.addEventListener(t,n))}function Nt(e){const t=new URL(e);return e?`${t.hostname}${t.pathname}`:"?"}function Rt(e){return`${e[0].toUpperCase()}${e.slice(1)}`}function p(e){var t="";return Array.isArray(e)?t=chrome.i18n.getMessage(e[0],e.splice(1)):t=chrome.i18n.getMessage(e),t.length?t:"{no translation}"}function J(e){return JSON.parse(JSON.stringify(e))}})();
