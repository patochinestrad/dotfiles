/*!
 * ExtSinglePageOpener
 * Part of the ExtHelpers project
 * @version  v1.7.0
 * @author   Gerrproger
 * @license  MIT License
 * Repo:     http://github.com/gerrproger/ext-helpers
 * Issues:   http://github.com/gerrproger/ext-helpers/issues
 */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e,document):"function"==typeof define&&define.amd?define(null,(function(){t(e,document)})):e.ExtSinglePageOpener=t(e,document)}("undefined"!=typeof window?window:this,(function(e,t){"use strict";return class{constructor(){this.isBackgroundScript=!(!chrome.extension.getBackgroundPage||chrome.extension.getBackgroundPage()!==e),this.pages=new Map,this.isBackgroundScript&&this._prepareBackground()}_prepareBackground(){chrome.runtime.onMessage.addListener(((e,t,r)=>{if(e.extSinglePageOpener)return this._openBackground(e.extSinglePageOpener,r),!0}))}_openBackground(e,t){const r=this._getUrl(e),o=this._splitUrl(r),n=this.pages.get(o[0]),i={active:!0};n?chrome.tabs.get(n,(n=>{!chrome.runtime.lastError&&n?(o.length>1&&(i.url=r),chrome.windows.update(n.windowId,{focused:!0}),chrome.tabs.update(n.id,i,t)):this._openNewTab(e,t)})):this._openNewTab(e,t)}_openContent(t,r){chrome.runtime.sendMessage({extSinglePageOpener:t},(t=>{if(chrome.runtime.lastError||!t)throw new Error("ExtSinglePageOpener should also be initilized in the background page script!");r.call(e,t)}))}_openNewTab(t,r){const o=this._getUrl(t),n=t=>{this.pages.set(this._splitUrl(o)[0],t.id),r.call(e,t)};t.type?chrome.windows.create({...t,focused:!0,url:o},(e=>{n(e.tabs[0])})):chrome.windows.getCurrent({},(e=>{if(e)return chrome.windows.update(e.id,{focused:!0}),void chrome.tabs.create({url:o},n);chrome.windows.create({focused:!0,url:o},(e=>{n(e.tabs[0])}))}))}_getUrl(e){const t=e.url||e,r=t.match(/^@@dir(.*)/);return r?chrome.extension.getURL(r[1]):t}_splitUrl(e){return e.split(/\?|#/)}open(e,t=(()=>{})){if("function"!=typeof t)throw new Error("Callback should be a function!");if(!e||"string"!=typeof e&&("object"!=typeof e||"string"!=typeof e.url))throw new Error("URL or settings object with URL string is not provided!");this.isBackgroundScript?this._openBackground(e,t):this._openContent(e,t)}}}));
