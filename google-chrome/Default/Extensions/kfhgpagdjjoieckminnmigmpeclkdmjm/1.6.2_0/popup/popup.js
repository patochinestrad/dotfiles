(function(){"use strict";const a=nj,t={},n=new ExtStorageManager(null,i=>a(at.bind(this,i))),nt=new ExtSinglePageOpener;window.storage=n,a(()=>{const i=c("@@extension_id");t.document=a(document),t.wrapper=a("#wrapper"),t.switchMain=a("#switchMain"),t.version=a("#version"),t.statPoints=a("#statPoints"),t.statDrops=a("#statDrops"),t.statMoments=a("#statMoments"),t.statDatePoints=a("#statDatePoints"),t.statDateDrops=a("#statDateDrops"),t.statDateMoments=a("#statDateMoments"),t.notifications=a("#notifications"),t.notificationsContent=a("#notificationsContent"),t.notificationsCount=a("#notificationsCount"),t.notificationsInfo=a("#notificationsInfo"),t.rateOffer=a("#rateOffer"),t.rateOfferClose=a("#rateOfferClose"),t.patreonOffer=a("#patreonOffer"),t.patreonOfferClose=a("#patreonOfferClose"),t.translateOffer=a("#translateOffer"),t.translateOfferClose=a("#translateOfferClose"),t.popupClose=a("#popupClose"),t.elRateOffer=a("#elRateOffer"),t.elPatreonOffer=a("#elPatreonOffer"),t.elBoostyOffer=a("#elBoostyOffer"),t.elTranslateOffer=a("#elTranslateOffer"),t.elReviews=a("#elReviews"),t.popup=a("#popup"),t.popupContent=a("#popupContent"),t.elOpenHelp=a("#elOpenHelp"),t.elOpenContribs=a("#elOpenContribs"),t.popupOpenAlerts=a("#popupOpenAlerts"),t.popupOpenClaims=a("#popupOpenClaims"),t.popupOpenSettings=a("#popupOpenSettings"),t.popupOpenEvents=a("#popupOpenEvents"),t.popupOpenDonate=a("#popupOpenDonate"),t.linkOpenEbnull=a("#linkOpenEbnull"),t.linkOpenDiscord=a("#linkOpenDiscord"),J(t.document),X(t.document),Z(t.document),t.version.text(`v${chrome.runtime.getManifest().version}`),t.elRateOffer[0].href=`https://chrome.google.com/webstore/detail/${i}/reviews`,t.elReviews[0].href=`https://chrome.google.com/webstore/detail/${i}/reviews`,a(window).on("keydown",p=>{const o=()=>chrome.extension.getExtensionTabs().some(g=>g.window===window);(p.ctrlKey&&p.shiftKey||p.metaKey&&p.altKey)&&p.keyCode===73&&!o()&&(p.preventDefault(),nt.open(window.location.href))})});function at(i){new EbnullNotifier(n.get("notificationsApi"),n,{memCacheTime:29e4,storCacheTime:119e4}).getNotifications(1).then(e=>{if(!e.counts.all){t.notifications.removeClass("notifications_active"),chrome.runtime.sendMessage("hideBage");return}let l="";e.important.forEach(d=>{l+=`<div class="notif notif_important${d.read?" notif_read":""}">${d.title}</div>`}),e.normal.forEach(d=>{l+=`<div class="notif${d.read?" notif_read":""}">${d.title}</div>`}),t.notificationsContent.html(l),e.counts.notRead?(t.notificationsCount.text(e.counts.notRead),t.notificationsInfo.addClass("notifications__info_unread"),chrome.runtime.sendMessage("showNotifsBage")):(t.notificationsInfo.removeClass("notifications__info_unread"),chrome.runtime.sendMessage("hideBage")),t.notifications.addClass("notifications_active")}).catch(()=>{t.notifications.removeClass("notifications_active")}),n.onUpdate("settings.enabled",e=>{t.switchMain[0].checked=e}).onUpdate("statistics.totalPoints",e=>{C(e),x()}).onUpdate("statistics.totalDrops",e=>{E(e),x()}).onUpdate("statistics.totalMoments",e=>{F(e),x()}).onUpdate("lastPoints",e=>{g(e,null,null)}).onUpdate("lastDrops",e=>{g(null,e,null)}).onUpdate("lastMoments",e=>{g(null,null,e)}).onUpdate("settings.claimPoints",e=>{B("Points",e)}).onUpdate("settings.claimDrops",e=>{B("Drops",e)}).onUpdate("settings.claimMoments",e=>{B("Moments",e)}),i.settings.enabled&&(t.switchMain[0].checked=!0),a(document.documentElement).attr("lang",c("extension_lang")),t.linkOpenDiscord[0].href=i.discordUrl,t.linkOpenEbnull[0].href=i.ebnullUrl,C(i.statistics.totalPoints,!0),E(i.statistics.totalDrops,!0),F(i.statistics.totalMoments,!0),g(i.lastPoints,i.lastDrops,i.lastMoments),v(),x(),z(),w(i.state.introShown),["Points","Drops","Moments"].forEach(e=>{B(e,i.settings[`claim${e}`])}),W("ru")?t.elBoostyOffer.addClass("offer-block__link_active")[0].href=n.get("linkBoosty"):t.elPatreonOffer.addClass("offer-block__link_active")[0].href=n.get("linkPatreon"),t.elTranslateOffer[0].href=n.get("localizationUrl"),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup",page_location:"/popup"}}}),t.switchMain.on("keydown",e=>{e.keyCode===13&&t.switchMain[0].click()}).on("change",o),t.notifications.on("click",()=>{chrome.runtime.sendMessage("openNotifications")}),t.rateOfferClose.on("click",()=>{t.rateOffer.removeClass("offer-block_active"),n.set("state.rateOfferDisabled",!0),chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"rate_offer",action:"close"}}})}),t.patreonOfferClose.on("click",()=>{t.patreonOffer.removeClass("offer-block_active"),n.set("state.patreonOfferDisabled",!0),chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"patreon_offer",action:"close"}}})}),t.translateOfferClose.on("click",()=>{t.translateOffer.removeClass("offer-block_active"),n.set("state.translateOfferDisabled",!0),chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"translate_offer",action:"close"}}})}),t.popupClose.on("click",L),t.linkOpenEbnull.on("click",()=>{chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Link_Ebnull",page_location:"/link/ebnull"}}})}),t.linkOpenDiscord.on("click",()=>{chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Link_Discord",page_location:"/link/discord"}}})}),t.popupOpenAlerts.on("click",()=>{R("/components/alerts.html",e=>{const l=e.find("#settingTestPoints"),d=e.find("#settingTestDrops"),h=e.find("#settingTestMoments"),u=e.find("#settingTestRaids"),m=e.find("#settingTestPredictionsStart"),k=e.find("#settingTestPredictionsResult"),$=e.find("#settingTestReloads"),T={points:0,drops:0,moments:0,raids:0,predictionsStart:0,predictionsResult:0,reloads:0},D=(r,y)=>{e.find(`[data-type="${r}"]`).forEach(s=>{s.checked&&T[r]++,a(s).on("change",()=>{s.checked?T[r]++:T[r]--,y[0].disabled=!T[r]})}),!T[r]&&(y[0].disabled=!0)};let P=n.get("settings.cancelRaid")?1:0,M=1;D("points",l),D("drops",d),D("moments",h),D("raids",u),D("predictionsStart",m),D("predictionsResult",k),D("reloads",$),l.on("click",()=>{const r=n.get("lastPoints");r.unshift({claimID:O(),type:"points",pointsName:"TEST",login:"",displayName:"TEST",claimedAt:new Date().getTime(),points:33}),S("lastPoints",r)}),d.on("click",()=>{const r=n.get("lastDrops");r.unshift({id:O(),dropInstanceID:O(),type:"drops",name:"TEST",claimedAt:new Date().getTime(),benefit:{name:"TEST"},game:{name:"TEST"}}),S("lastDrops",r),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.drops.test",value:!0}}})}),h.on("click",()=>{const r=n.get("lastMoments");r.unshift({id:O(),momentID:O(),type:"moments",title:"TEST",slug:null,claimedAt:new Date().getTime(),broadcaster:{login:"",displayName:"TEST"}}),S("lastMoments",r),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.moments.test",value:!0}}})}),u.on("click",()=>{const r=n.get("lastRaids");r.unshift({id:O(),type:"raids",status:P,timestamp:new Date().getTime(),data:{canceled:!!P,login:"",displayName:"TEST1",to:{login:"",displayName:"TEST2"}}}),S("lastRaids",r),P=P===1?0:P+1,chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.raids.test",value:!0}}})}),m.on("click",()=>{const r=n.get("lastPredictions");r.unshift({id:O(),type:"predictions",status:0,timestamp:new Date().getTime(),data:{login:"",displayName:"TEST",channel_id:"",id:O(),prediction_window_seconds:60,status:"ACTIVE",title:"TEST",outcomes:[{color:"BLUE",title:"TEST1",id:O()},{color:"PINK",title:"TEST2",id:O()}]}}),S("lastPredictions",r),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.predictions_start.test",value:!0}}})}),k.on("click",()=>{const r=n.get("lastPredictions");r.unshift({id:O(),type:"predictions",status:M,timestamp:new Date().getTime(),data:{login:"",displayName:"TEST",channel_id:"",id:O(),outcome_id:O(),points:33,pointsWon:M===1?99:0,status:M===1?"WIN":M===2?"LOSE":"REFUND"}}),S("lastPredictions",r),M=M===3?1:M+1,chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.predictions_result.test",value:!0}}})}),$.on("click",()=>{const r=n.get("lastReloads");r.unshift({id:O(),type:"reloads",status:1,timestamp:new Date().getTime(),data:{reloadType:"TEST",page:"https://www.twitch.tv/__TEST"}}),S("lastReloads",r),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"alerts.reloads.test",value:!0}}})})}),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup_Alerts",page_location:"/popup/alerts"}}})}),t.popupOpenClaims.on("click",()=>{R("/components/claims.html",e=>{const l=n.get("config.dropsTag"),d=e.find("#claimsList"),h=e.find("#claimsListEmpty"),u=e.find("#claimsListFilter"),m=()=>{const k=n.get("settings.claimsHistoryFilter"),$=n.get("lastPoints"),T=n.get("lastDrops"),D=n.get("lastMoments"),P=n.get("config.hashDrop"),M="https://www.twitch.tv/",r=k==="points"?$:k==="drops"?T:k==="moments"?D:T.concat($).concat(D);if(!r.length){d.html(""),h.addClass("history-list-empty_active");return}let y="";r.sort((s,f)=>f.claimedAt-s.claimedAt).forEach(s=>{const f=s.type,U=s.claimedAt,_=s.benefit&&s.benefit.imageAssetURL||s.image||s.thumbnailURL||`/img/${f}-icon.svg`,H=s.benefit&&s.benefit.name||f==="points"&&(s.pointsName||c("alert_pointsVar"))||f==="moments"&&s.title||c("stat_unknown"),K=f==="drops"&&c("alert_drop")||f==="moments"&&c("alert_moment")||f==="points"&&`${s.points||"?"} ${c("alert_points")}`||c("stat_unknown"),G=s.game&&s.game.name||s.displayName||s.broadcaster&&s.broadcaster.displayName||null,A=encodeURIComponent(s.game&&s.game.name||s.login||s.broadcaster&&s.broadcaster.login||""),V=f==="drops"&&`directory/game/${A}?${l}`||f==="points"&&A||f==="moments"&&A||"",Q=f==="drops"&&`${M}drops/inventory${P}${encodeURIComponent(H)}`||f==="points"&&(A?tt(A):M)||f==="moments"&&`https://clips.twitch.tv/${s.slug||""}`||"";y+=`<div class="history-list-item history-list-item_claim history-list-item_${f}"><div class="history-list-item__header">`,y+=`<span class="history-list-item__title">${K}</span>`,y+=`<span class="history-list-item__date" data-date="${U}">${b(U)}</span></div>`,y+=`<a class="history-list-item__body" target="_blank" rel="noreferrer" href="${Q}">`,y+=`<span class="history-list-item__body-icon"></span><img class="history-list-item__img" src="${_}" alt="${H}" data-type="${f}"/>`,f==="points"&&(y+=`<div class="history-list-item__modifier">&#215;${s.points||"?"}</div>`),y+=`<div class="history-list-item__name">${H}</div></a>`,y+=`<a class="history-list-item__footer" target="_blank" rel="noreferrer" href="${M}${V}">`,y+=`${f==="drops"&&c("alert_forGame")||f==="moments"&&c("alert_forChannel")||f==="points"&&c("alert_forChannel")||""} `,y+=`<b>${G||c("stat_unknown")}</b><span class="history-list-item__footer-icon"></span></a></div>`}),d.html(y).find(".history-list-item__img").on("error",s=>{s.target.src=`/img/${a(s.target).data("type")}-icon.svg`}),h.removeClass("history-list-empty_active")};u[0].value=n.get("settings.claimsHistoryFilter"),u.on("change",()=>{const k=u[0].value;n.set("settings.claimsHistoryFilter",k),m(),e[0].scrollTop=0,chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"history.claims.filter",value:k}}})}),m(),n.onUpdate("lastPoints",m,"popup").onUpdate("lastDrops",m,"popup").onUpdate("lastMoments",m,"popup"),n.onUpdate("settings.claimsHistoryFilter",k=>{u[0].value=k,m()},"popup")}),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup_Claims",page_location:"/popup/claims"}}})}),t.popupOpenSettings.on("click",()=>{R("/components/settings.html",e=>{e.find("#settingResetExtension").on("click",()=>{t.wrapper.addClass("wrapper_loading"),n.set("processExtensionReload",!0),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"app.reset",value:!0}}})}),e.find("#settingResetStats").on("click",()=>{chrome.runtime.sendMessage({resetStats:!0}),L(),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"app.reset_stats",value:!0}}})})}),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup_Settings",page_location:"/popup/settings"}}})}),t.popupOpenEvents.on("click",()=>{R("/components/events.html",e=>{const l=e.find("#eventsList"),d=e.find("#eventsListEmpty"),h=e.find("#eventsListFilter"),u=()=>{const m=n.get("settings.eventsHistoryFilter"),k=n.get("lastRaids"),$=n.get("lastPredictions"),T=n.get("lastReloads"),D=n.get("config.luckyFactorPredict"),P="https://www.twitch.tv/",M=m==="raids"?k:m==="predictions"?$:m==="reloads"?T:k.concat($,T);if(!M.length){l.html(""),d.addClass("history-list-empty_active");return}let r="";M.sort((y,s)=>s.timestamp-y.timestamp).forEach(y=>{const s=y.type,f=y.status,U=y.timestamp,_=y.data,H=["points","moments","raids","predictions"].includes(s),K=["reloads"].includes(s),G=s==="raids"&&c("alert_raids")||s==="predictions"&&c(f===0?"alert_predictionsStart":"alert_predictionsResult")||s==="reloads"&&c("alert_reloads")||c("stat_unknown"),A=s==="raids"&&c("alert_raidsDescr")||s==="predictions"&&c(f===0?"alert_predictionsDescrStart":f===1?"alert_predictionsDescrWin":f===2?"alert_predictionsDescrLose":"alert_predictionsDescrRefund")||s==="reloads"&&c("alert_reloadsDescr")||"",V=s==="raids"&&`${P}${_.to.login}`||s==="predictions"&&(_.login?tt(_.login):P)||s==="reloads"&&_.page||"",Q=s==="raids"&&_.to.displayName||s==="predictions"&&(f===0?_.title:`${f===1?_.pointsWon:_.points} ${c("alert_pointsVar")}`)||s==="reloads"&&ot(_.page)||c("stat_unknown"),rt=["raids","predictions"].includes(s)&&`${P}${_.login||""}`||"",lt=["raids","predictions"].includes(s)&&_.displayName||c("stat_unknown"),et=_.pointsWon&&(_.pointsWon/_.points).toFixed(1),st=["playbackError","integrityFail"].includes(_.reloadType),ct=s==="predictions"&&f===0&&c("alert_predictionsDescrOutcomes")||s==="reloads"&&c("alert_reloadsDescrReason")||"";let I="";Array.isArray(_.outcomes)?_.outcomes.forEach((Y,pt)=>{pt&&(I+=", "),I+=`<b class="color color_${Y.color&&Y.color.toLowerCase()}">${Y.title}</b>`}):_.hasOwnProperty("reloadType")&&(I=`<b class="color color_warn">${st&&c(`alert_reloadsDescr${it(_.reloadType)}`)||c("stat_unknown")}</b>`),r+=`<div class="history-list-item history-list-item_event history-list-item_${s}"><div class="history-list-item__header">`,r+=`<span class="history-list-item__title">${G}</span>`,r+=`<span class="history-list-item__date" data-date="${U}">${b(U)}</span></div>`,r+=`<div class="history-list-item__body"><span class="history-list-item__descr">${A}</span>`,V&&(r+=`&nbsp;<a class="history-list-item__link" target="_blank" rel="noreferrer" href="${V}">${Q}<span class="history-list-item__link-icon"></span></a>`),I&&(r+=`<div class="history-list-item__descr2">${ct} ${I}</div>`),s==="predictions"&&f===1&&(r+=`<div class="history-list-item__descr2">${c("alert_winFactor")} <b class="color">x${et}</b></div>`),s==="reloads"&&st&&(r+=`<button class="history-list-item__btn history-list-item__btn_help" data-param="${_.reloadType==="playbackError"&&"errors_playback"||_.reloadType==="integrityFail"&&"errors_integrity"||""}" data-type="help">${c("alert_learnMore")}</button>`),s==="predictions"&&f===1&&et>=D&&(r+=`<div class="history-list-item__warn">${c("alert_criticalLuck")}</div>`),s==="raids"&&_.canceled&&(r+=`<div class="history-list-item__warn">${c("alert_raidsCanceled")}</div>`),K?r+=`</div><div class="history-list-item__footer history-list-item__footer_automation"><i>${c("alert_extAutomation")}</i></div></div>`:(r+=`</div><a class="history-list-item__footer" target="_blank" rel="noreferrer" href="${rt}">${H&&c("alert_forChannel")||""} `,r+=`<b>${lt}</b><span class="history-list-item__footer-icon"></span></a></div>`)}),l.html(r),d.removeClass("history-list-empty_active"),l.find(".history-list-item__btn").on("click",y=>{const s=y.target.dataset,f=s.type,U=s.param;U&&f==="help"&&N(U)})};h[0].value=n.get("settings.eventsHistoryFilter"),h.on("change",()=>{const m=h[0].value;n.set("settings.eventsHistoryFilter",m),u(),e[0].scrollTop=0,chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"history.events.filter",value:m}}})}),u(),n.onUpdate("lastRaids",u,"popup").onUpdate("lastPredictions",u,"popup").onUpdate("lastReloads",u,"popup"),n.onUpdate("settings.eventsHistoryFilter",m=>{h[0].value=m,u()},"popup")}),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup_Events",page_location:"/popup/events"}}})}),t.popupOpenDonate.on("click",()=>{const e=n.get("linkBuymeacoffee"),l=n.get("linkPatreon"),d=n.get("linkBoosty");R("/components/donate.html",h=>{h.find("#donateLinkBuymeacoffee").text(e.slice(8)).on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"link_buymeacoffee",action:"click"}}}))[0].href=e,h.find("#donateLinkPatreon").text(l.slice(8)).on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"link_patreon",action:"click"}}}))[0].href=l,h.find("#donateLinkBoosty").text(d.slice(8)).on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"link_boosty",action:"click"}}}))[0].href=d,h.find(".selectable").on("click",u=>{u.target.select()}),h.find(".donate-control_copy").on("click",u=>{const m=a(u.target),k=m.closest(".donate-type").find(".selectable")[0].value;navigator.clipboard.writeText(k).then(()=>{m.addClass("donate-control_success"),setTimeout(()=>{m.removeClass("donate-control_success")},2e3)})}),h.find(".donate-control_qr").on("click",u=>{const m=a(u.target).closest(".donate-type").find(".qr-code"),k=m.hasClass("qr-code_active");h.find(".qr-code").removeClass("qr-code_active"),!k&&m.addClass("qr-code_active")}),W("ru")&&h.find("#donateBoosty").removeClass("hidden")}),chrome.runtime.sendMessage({analytics:{name:"page_view",params:{page_title:"Popup_Donates",page_location:"/popup/donates"}}})}),t.elOpenHelp.on("click",()=>N()),t.elOpenContribs.on("click",()=>j()),t.elRateOffer.on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"rate_offer",action:"click"}}})),t.elPatreonOffer.on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"patreon_offer",action:"click"}}})),t.elBoostyOffer.on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"boosty_offer",action:"click"}}})),t.elTranslateOffer.on("click",()=>chrome.runtime.sendMessage({analytics:{name:"loyalty",params:{kind:"translate_offer",action:"click"}}}));function o(){const e=t.switchMain[0].checked;n.set("settings.enabled",e),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:"app.enabled",value:e}}})}function g(e,l,d){const h=[t.statDatePoints,t.statDateDrops,t.statDateMoments];[e,l,d].forEach((u,m)=>{u&&(u[0]?(h[m].text(b(u[0].claimedAt)),h[m].data({date:u[0].claimedAt})):(h[m].text(c("stat_never")),h[m].removeData("date")))})}function b(e){const l={year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4},d=new Intl.RelativeTimeFormat({numeric:"auto"});return!!e&&(typeof e=="string"?e:((m,k=new Date)=>{const $=m-k;for(const T in l){if(Math.abs($)>l[T])return d.format(Math.round($/l[T]),T);if(T==="minute")return c($>-2e4?"stat_now":"stat_recent")}})(new Date(e)))||c("stat_unknown")}function v(){a("[data-date]").forEach(e=>{const l=a(e),d=l.data("date");l.text(b(d))}),setTimeout(v,3e3)}function C(e,l){const d=e||0;t.statPoints.removeClass("stat__big_active"),setTimeout(()=>{!l&&t.statPoints.addClass("stat__big_active"),t.statPoints.text(d.toLocaleString())},0)}function E(e,l){const d=e||0;t.statDrops.removeClass("stat__big_active"),setTimeout(()=>{!l&&t.statDrops.addClass("stat__big_active"),t.statDrops.text(d.toLocaleString())},0)}function F(e,l){const d=e||0;t.statMoments.removeClass("stat__big_active"),setTimeout(()=>{!l&&t.statMoments.addClass("stat__big_active"),t.statMoments.text(d.toLocaleString())},0)}function N(e){chrome.runtime.sendMessage({openHelp:!0,section:e})}function j(){chrome.runtime.sendMessage({openContribs:!0})}function R(e,l){fetch(e).then(d=>d.text()).then(d=>{t.popupContent.html(d),J(t.popupContent),X(t.popupContent,"popup"),Z(t.popupContent),t.popupContent[0].scrollTop=0,typeof l=="function"&&l(t.popupContent),t.popup.addClass("popup_active"),t.wrapper.addClass("wrapper_minheight")})}function L(){t.wrapper.removeClass("wrapper_minheight"),t.popup.removeClass("popup_active"),t.document.off("click","popup:balloon"),n.offUpdate("popup"),setTimeout(()=>{t.popupContent.html("")},500)}function w(e){e||R("/components/intro.html",l=>{l.find("#introOpenHelp").on("click",()=>{N(),L()}),l.find("#introClose").on("click",L),setTimeout(()=>{n.set("state.introShown",!0)},1e3)})}function x(){const e="offer-block_active",l=n.get("statistics.totalPoints"),d=n.get("statistics.totalDrops"),h=n.get("statistics.totalMoments"),u=l>15e3||d>9||h>4;d>50&&!n.get("state.patreonOfferDisabled")?(t.patreonOffer.addClass(e),t.rateOffer.removeClass(e)):u&&!n.get("state.rateOfferDisabled")&&(t.rateOffer.addClass(e),t.patreonOffer.removeClass(e))}function z(){const e="offer-block_active";!n.get("locales").some(d=>W(d,!0))&&!n.get("state.translateOfferDisabled")&&t.translateOffer.addClass(e)}}function B(i,p){const o=t[`stat${i}`];p?o.removeClass("stat__big_disabled"):o.addClass("stat__big_disabled")}function J(i){q(i).find("[data-i18n]").forEach(p=>{const o=a(p),b=o.text().split("+").reduce((v,C,E)=>(E&&(v+=" "),v+=C.match(/^(-|_|â€”|\/|\s)$/)?C:c(C),v),"");o.html(b||"{no_text}")}),q(i).find("[data-i18n-attr]").forEach(p=>{const o=a(p),g=o.data("i18n-attr");o.attr(g,c(o.attr(g)))})}function X(i,p){q(i).find("[data-setting]").forEach(o=>{const g=a(o),b=g.closest(),v=`settings.${o.dataset.setting}`,C=["checkbox","radio"].includes(o.type),E=o.type==="range",F=b.find("[data-value]"),N=o.dataset.claimStatus,j=()=>{const w=C?o.checked:E?parseInt(o.value):o.value;n.set(v,w),L(),N&&B(N,w),chrome.runtime.sendMessage({analytics:{name:"setting",params:{kind:o.dataset.setting,value:w}}})},R=w=>{C?o.checked=w:o.value=w,L()},L=()=>{const w=o.value,x=o.dataset.unit,z=typeof o.dataset.unitTime=="string";if(!F)return;if(!x&&!z){F.text(w);return}if(x){F.text(`${w}${x}`);return}const e=Math.floor(w/60),l=w-e*60;F.text(`${e}:${l<10?"0":""}${l}`)};R(n.get(v)),n.onUpdate(v,w=>{R(w)},p),g.on("keydown",w=>{w.keyCode===13&&C&&o.click()}).on("input",L).on("change",j)})}function Z(i){q(i).find("[data-balloon]").forEach(p=>{const o=a(p),g=typeof o.attr("data-balloon-tooltip")=="string",b=typeof o.attr("data-balloon-hover")=="string",v=()=>{o.removeClass("balloon_active"),!g&&t.document.off("click","popup:balloon")};let C=null;o.find("[data-balloon-content]").on("click",E=>E.stopPropagation()),o.find("[data-balloon-trigger]").on("click",()=>{o.addClass("balloon_active"),setTimeout(()=>t.document.on("click",v,"popup:balloon"),0)}),o.find("[data-balloon-action]").on("click",v),b&&o.on("mouseenter",()=>{C=setTimeout(()=>o.addClass("balloon_active"),n.get("config.transitionDelay"))}).on("mouseleave",()=>{clearTimeout(C),o.removeClass("balloon_active")}),g&&t.document.on("click",v,"tooltip:balloon")})}function tt(i,p){const o="https://www.twitch.tv/embed/",g=n.get("config.hashPointsFs"),b=n.get("config.hashPointsFsP");let v="parent=www.twitch.tv&parent=player.twitch.tv";if(p){const C=new URL(location.href).searchParams.getAll("parent");C&&C.forEach(E=>{v+=`&parent=${E}`})}return`${o}${i}/chat?${v}${p?b:g}`}function S(i,p){const o=n.get(`config.${i}Maxlength`);p.length>o&&(p=p.slice(0,o)),n.set(i,p,g=>{g==="QUOTA_BYTES_PER_ITEM quota exceeded"&&(p.pop(),S(i,p))})}function W(i,p){const o=i.toLowerCase().split(/_|-/),g=navigator.language.toLowerCase().split(/_|-/),b=o[0]===g[0];return(p?o[1]||g[1]:o[1]&&g[1])?b&&o[1]===g[1]:b}function q(i){return i.length?i:a(i)}function O(i){const p="abcdefghijklmnopqrstuvwxyz0123456789",o=p.length,g=i||10;let b="";for(var v=0;v<g;v++)b+=p.charAt(Math.floor(Math.random()*o));return b}function ot(i){const p=new URL(i);return i?`${p.hostname}${p.pathname}`:"?"}function it(i){return`${i[0].toUpperCase()}${i.slice(1)}`}function c(i){let p="";return Array.isArray(i)?p=chrome.i18n.getMessage(i[0],i.splice(1)):p=chrome.i18n.getMessage(i),p||"{no translation}"}})();
